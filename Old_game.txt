The old game: 
# Tietokanta yhteys
import mysql.connector
import uuid
import random
import textwrap

kÃ¤yty_kentÃ¤t = []
yhteys = mysql.connector.connect(
Â  Â  host='127.0.0.1',
Â  Â  port=3306,
Â  Â  database='lentopeli',
Â  Â  user='root',
Â  Â  password='whopper',
Â  Â  autocommit=True
)


# Funktiot

def arvo_aarre(pelaaja_id, yhteys):
Â  Â  kursori = yhteys.cursor()
Â  Â  global kÃ¤yty_kentÃ¤t

Â  Â  # Tarkistetaan onko pelaajalla jo aarre
Â  Â  kursori.execute("SELECT airport_ident, found FROM treasure WHERE player_id = %s", (pelaaja_id,))
Â  Â  tulos = kursori.fetchone()
Â  Â  if tulos is not None:
Â  Â  Â  Â  return tulos[0]Â  # Palautetaan olemassa oleva aarre

Â  Â  # Jos ei ole, arvotaan uusi aarre
Â  Â  airport_rows = lentokenttÃ¤Ã¤()
Â  Â  airport_idents = [row[0] for row in airport_rows]

Â  Â  # Hae jo kÃ¤ydyt kentÃ¤t
Â  Â  kursori.execute("SELECT kÃ¤yty_kentÃ¤t FROM game WHERE id = %s", (pelaaja_id,))
Â  Â  tulos = kursori.fetchone()
Â  Â  kÃ¤yty_kentÃ¤t = tulos[0].split(",") if tulos and tulos[0] else []
Â  Â  mahdolliset = [k for k in airport_idents if k not in kÃ¤yty_kentÃ¤t]

Â  Â  if not mahdolliset:
Â  Â  Â  Â  mahdolliset = airport_identsÂ  # jos kaikki kÃ¤yty, valitaan satunnainen

Â  Â  aarre_kenttÃ¤ = random.choice(mahdolliset)

Â  Â  # Tallennetaan treasure-tauluun
Â  Â  kursori.execute("""
Â  Â  Â  Â  INSERT INTO treasure (player_id, airport_ident, found)
Â  Â  Â  Â  VALUES (%s, %s, %s)
Â  Â  Â  Â  ON DUPLICATE KEY UPDATE airport_ident = %s, found = %s
Â  Â  """, (pelaaja_id, aarre_kenttÃ¤, False, aarre_kenttÃ¤, False))

Â  Â  yhteys.commit()
Â  Â  #print(f"ğŸ¯ Uusi aarre arvottu kentÃ¤lle {aarre_kenttÃ¤}.")
Â  Â  return aarre_kenttÃ¤

def loppu(kÃ¤yttÃ¤jÃ¤, pelaaja_id):
Â  Â  cursor = yhteys.cursor()
Â  Â  cursor.execute(
Â  Â  Â  Â  "SELECT motivaatio_taso, has_treasure, location FROM game WHERE id = %s",
Â  Â  Â  Â  (pelaaja_id,)
Â  Â  )
Â  Â  rows = cursor.fetchall()
Â  Â  cursor.close()

Â  Â  if not rows:
Â  Â  Â  Â  print("Pelaajaa ei lÃ¶ytynyt tietokannasta.")
Â  Â  Â  Â  return None

Â  Â  motivaatio_taso, has_treasure, location = rows[0]
Â  Â  print(f"Motivaatiotasosi on {motivaatio_taso}, "
Â  Â  Â  Â  Â  f"{'sinulla on superpallo' if has_treasure else 'superpallo edelleen hukassa'}, "
Â  Â  Â  Â  Â  f"sijaintisi ICAO-koodi on {location}")

Â  Â  if motivaatio_taso is None or motivaatio_taso <= 0:
Â  Â  Â  Â  print(f"{kÃ¤yttÃ¤jÃ¤} menetti motivaationsa kokonaan ja masentui."
Â  Â  Â  Â  Â  Â  Â  "\nHÃ¤n palasi kotiinsa ja eli tyÃ¶kyvyttÃ¶mÃ¤nÃ¤ elÃ¤mÃ¤nsÃ¤ loppuun asti.")
Â  Â  Â  Â  exit(1)
Â  Â  elif motivaatio_taso <= 10 and has_treasure == 1 and location == "EFHK":
Â  Â  Â  Â  print(f"{kÃ¤yttÃ¤jÃ¤} onnistui tuomaan Sir Pommin takaisin kotiin!"
Â  Â  Â  Â  Â  Â  Â  "\nSir Pomm oli aivan entisellÃ¤Ã¤n. Edelleen yhtÃ¤ sininen ja kimmoisa kuin ennenkin"
Â  Â  Â  Â  Â  Â  Â  f"\n{kÃ¤yttÃ¤jÃ¤} pompotteli superpalloaan onnellisena elÃ¤mÃ¤nsÃ¤ loppuun saakka."
Â  Â  Â  Â  Â  Â  Â  "\nEikÃ¤ Sir Pomm enÃ¤Ã¤ lÃ¤htenyt matkoilleen.")
Â  Â  else:
Â  Â  Â  Â  return





def onko_aarre_lÃ¶ydetty(pelaaja_id, yhteys):
Â  Â  kursori = yhteys.cursor()
Â  Â  kursori.execute("SELECT found FROM treasure WHERE player_id = %s", (pelaaja_id,))
Â  Â  tulos = kursori.fetchone()
Â  Â  if tulos is None:
Â  Â  Â  Â  return False
Â  Â  return bool(tulos[0])


# Pien pelit

def kysymys_EGLL():
Â  Â  kysymys = "\nMikÃ¤ on Lontoon tunnettu historiallinen kellotorni, jota kutsutaan Elizabeth Toweriksi?\nA) Big Ben\nB) Ben Ten\nC) Big Ten\nD) London Eye"
Â  Â  oikea_vastaus = "A"
Â  Â  return kysymys, oikea_vastaus


def kysymys_CYYZ():
Â  Â  kysymys = "\nMikÃ¤ on Kanadan PÃ¤Ã¤kaupunki?\nA) Toronto\nB) Edmonton\nC) Vancouver\nD) Ottawa"
Â  Â  oikea_vastaus = "D"
Â  Â  return kysymys, oikea_vastaus


def kysymys_EDDF():
Â  Â  kysymys = "\nMikÃ¤ joki virtaa Saksan lÃ¤pi ja on yksi Euroopan pisimmistÃ¤?\nA) Rein\nB) Tonava\nC) Seine\nD) Thames"
Â  Â  oikea_vastaus = "A"
Â  Â  return kysymys, oikea_vastaus


def kysymys_EHAM():
Â  Â  kysymys = "\nKuka tunnetuista taiteilijoista on Alankomaista kotoisin?\nA) Leonardo Da Vinci\nB) Ludwig van Beethoven\nC) Vincent van Gogh"
Â  Â  oikea_vastaus = "C"
Â  Â  return kysymys, oikea_vastaus


def kysymys_FAOR():
Â  Â  kysymys = "\nMikÃ¤ vuori sijaitsee EtelÃ¤-Afrikassa?\nA) PÃ¶ytÃ¤vuori\nB) Kilimanjaro\nC) Mount Kenya\nD) Drakensberg"
Â  Â  oikea_vastaus = "A"
Â  Â  return kysymys, oikea_vastaus


def kysymys_HECA():
Â  Â  kysymys = "\nMikÃ¤ oli muinaisen Egyptin kirjoitusjÃ¤rjestelmÃ¤?\nA) Kyrillinen\nB) Latinan kirjaimet\nC) Hieroglyfit"
Â  Â  oikea_vastaus = "C"
Â  Â  return kysymys, oikea_vastaus


def kysymys_KDFW():
Â  Â  kysymys = "\nMikÃ¤ on Texasin osavaltion lempinimi?\nA) The Golden State\nB) The Sunshine State\nC) The Lone Star State\nD) The Empire State"
Â  Â  oikea_vastaus = "C"
Â  Â  return kysymys, oikea_vastaus


def kysymys_KJFK():
Â  Â  kysymys = "\nMikÃ¤ oli New Yorkin alkuperÃ¤inen nimi, ennen kuin englantilaiset valtasivat kaupungin?\nA) York\nB) New Amsterdam\nC) Gotham"
Â  Â  oikea_vastaus = "B"
Â  Â  return kysymys, oikea_vastaus


def kysymys_KLAX():
Â  Â  kysymys = "\nMikÃ¤ kuuluisa Los Angelesissa sijaitseva katu on tunnettu elokuvateollisuudestaan ja tÃ¤htien nimillÃ¤ koristellusta jalkakÃ¤ytÃ¤vÃ¤stÃ¤Ã¤n?\nA) Sunset Boulevard\nB) Mulholland Drive\nC) Hollywood Boulevard\nD) Rodeo Drive"
Â  Â  oikea_vastaus = "C"
Â  Â  return kysymys, oikea_vastaus


def kysymys_LEMD():
Â  Â  kysymys = "\nMissÃ¤ Espanjan kaupungissa jÃ¤rjestetÃ¤Ã¤n kuuluisa La Tomatina, tomaattisota?\nA) Valencia\nB) Zaragoza\nC) Sevilla\nD) BuÃ±ol"
Â  Â  oikea_vastaus = "D"
Â  Â  return kysymys, oikea_vastaus


def kysymys_LFPG():
Â  Â  kysymys = "\nMikÃ¤ nÃ¤istÃ¤ nÃ¤htÃ¤vyyksistÃ¤ ei ole Pariisissa?\nA) Notre Dame\nB) Riemukaari\nC) Louvre\nD) Mont Blanc"
Â  Â  oikea_vastaus = "D"
Â  Â  return kysymys, oikea_vastaus


def kysymys_NZAA():
Â  Â  kysymys = "\nMikÃ¤ Uuden-Seelannin alkuperÃ¤iskansa on nimeltÃ¤Ã¤n?\nA) Maori\nB) Aboriginaalit\nC) Inuit\nD) Samoalaiset"
Â  Â  oikea_vastaus = "A"
Â  Â  return kysymys, oikea_vastaus


def kysymys_OMDB():
Â  Â  kysymys = "\nMikÃ¤ on maailman korkeimman rakennuksen nimi, joka sijaitsee Dubaissa?"
Â  Â  oikea_vastaus = "burj khalifa"
Â  Â  return kysymys, oikea_vastaus


def kysymys_RJTT():
Â  Â  kysymys = "\nMinkÃ¤ vuoren voi nÃ¤hdÃ¤ Tokiosta?\nA) Hakkoda\nB) Fuji\nC) Everest\nD) Hekla"
Â  Â  oikea_vastaus = "B"
Â  Â  return kysymys, oikea_vastaus


def kysymys_RKSI():
Â  Â  kysymys = "\nMikÃ¤ on EtelÃ¤-Korean kansallisruoka?\nA) Sushi\nB) Pho\nC) Ramen\nD) Kimchi"
Â  Â  oikea_vastaus = "D"
Â  Â  return kysymys, oikea_vastaus


def kysymys_SBGR():
Â  Â  kysymys = "\nMikÃ¤ on Brasilian suurin ja tunnetuin sademetsÃ¤, joka tunnetaan suuresta monimuotoisuudestaan?"
Â  Â  oikea_vastaus = "amazon"
Â  Â  return kysymys, oikea_vastaus


def kysymys_SKBO():
Â  Â  kysymys = "\nMikÃ¤ on Kolumbian virallinen kieli?\nA) Portugali\nB) Ranska\nC) Englanti\nD) Espanja"
Â  Â  oikea_vastaus = "D"
Â  Â  return kysymys, oikea_vastaus


def kysymys_YSSY():
Â  Â  kysymys = "\nMikÃ¤ on Australian PÃ¤Ã¤kaupunki?\nA) Sydney\nB) Canberra\nC) Melbourne\nD) Brisbane"
Â  Â  oikea_vastaus = "B"
Â  Â  return kysymys, oikea_vastaus


def kysymys_ZBAA():
Â  Â  kysymys = "\nMikÃ¤ kuuluisa historiallinen palatsialue sijaitsee PekingissÃ¤?\nA) KesÃ¤palatsi\nB) Kielletty kaupunki\nC) Taivaallisen rauhan aukio\nD) Ming-haudat"
Â  Â  oikea_vastaus = "B"
Â  Â  return kysymys, oikea_vastaus


# Motivaatio taso Funktio
def pÃ¤ivitÃ¤_motivaatio_taso(pelaaja_id, yhteys, mÃ¤Ã¤rÃ¤):
Â  Â  kursori = yhteys.cursor()
Â  Â  kursori.execute("update game set Motivaatio_taso = Motivaatio_taso + %s where id = %s ", (mÃ¤Ã¤rÃ¤, pelaaja_id))
Â  Â  yhteys.commit()
Â  Â  print(f"ğŸ“Š Pisteesi pÃ¤ivitetty: {'+' if mÃ¤Ã¤rÃ¤ > 0 else ''}{mÃ¤Ã¤rÃ¤} pistettÃ¤!")
Â  Â  loppu(kÃ¤yttÃ¤jÃ¤,pelaaja_id)


# Funktio hoitaa yritykset, oikeat/vÃ¤Ã¤rÃ¤t vastaukset ja pisteiden pÃ¤ivityksen

def pelaa_minipeli(player_id, yhteys, kysymys, oikea_vastaus, max_yritykset=3):
Â  Â  print(kysymys)
Â  Â  yritys = 0

Â  Â  while yritys < max_yritykset:
Â  Â  Â  Â  vastaus = input(f"Yritys {yritys + 1}/{max_yritykset}: ")
Â  Â  Â  Â  yritys += 1

Â  Â  Â  Â  if vastaus.strip().lower() == oikea_vastaus.strip().lower():
Â  Â  Â  Â  Â  Â  print("âœ… Oikein! Saat 1 pisteen.")
Â  Â  Â  Â  Â  Â  pÃ¤ivitÃ¤_motivaatio_taso(player_id, yhteys, +1)
Â  Â  Â  Â  Â  Â  return True
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  print("âŒ VÃ¤Ã¤rin!")

Â  Â  print("ğŸ˜¢ Yritykset loppuivat! HÃ¤visit ja menetÃ¤t 1 pisteen.")
Â  Â  pÃ¤ivitÃ¤_motivaatio_taso(player_id, yhteys, -1)
Â  Â  return False



# Pien peli Funktio - antaa jokaselle kentÃ¤lle oman pelin
def kÃ¤ynnistÃ¤_peli(ICAO, pelaaja_id, yhteys):
Â  Â  pelit = {
Â  Â  Â  Â  "EGLL": kysymys_EGLL,
Â  Â  Â  Â  "LFPG": kysymys_LFPG,
Â  Â  Â  Â  "RJTT": kysymys_RJTT,
Â  Â  Â  Â  "OMDB": kysymys_OMDB,
Â  Â  Â  Â  "EDDF": kysymys_EDDF,
Â  Â  Â  Â  "EHAM": kysymys_EHAM,
Â  Â  Â  Â  "LEMD": kysymys_LEMD,
Â  Â  Â  Â  "KLAX": kysymys_KLAX,
Â  Â  Â  Â  "KJFK": kysymys_KJFK,
Â  Â  Â  Â  "CYYZ": kysymys_CYYZ,
Â  Â  Â  Â  "KDFW": kysymys_KDFW,
Â  Â  Â  Â  "ZBAA": kysymys_ZBAA,
Â  Â  Â  Â  "RKSI": kysymys_RKSI,
Â  Â  Â  Â  "YSSY": kysymys_YSSY,
Â  Â  Â  Â  "NZAA": kysymys_NZAA,
Â  Â  Â  Â  "SBGR": kysymys_SBGR,
Â  Â  Â  Â  "FAOR": kysymys_FAOR,
Â  Â  Â  Â  "HECA": kysymys_HECA,
Â  Â  Â  Â  "SKBO": kysymys_SKBO,
Â  Â  Â  Â  # "EFHK": kysymys_EFHK,
Â  Â  }

Â  Â  if ICAO in pelit:
Â  Â  Â  Â  kysymys, oikea_vastaus = pelit[ICAO]()Â  # kutsutaan kysymysfunktiota
Â  Â  Â  Â  pelaa_minipeli(pelaaja_id, yhteys, kysymys, oikea_vastaus)
Â  Â  else:
Â  Â  Â  Â  print("TÃ¤llÃ¤ kentÃ¤llÃ¤ ei ole vielÃ¤ minipeliÃ¤. âœˆï¸")


# Funktio jossa on lista lentokenttien ICAO koodeista

def kaikki_lentokentÃ¤t():
Â  Â  # Lista kaikista peliin kuuluvista ICAO-koodeista
Â  Â  return ["EFHK", "EGLL", "LFPG", "RJTT", "OMDB", "EDDF",
Â  Â  Â  Â  Â  Â  "EHAM", "LEMD", "KLAX", "KJFK", "CYYZ", "KDFW",
Â  Â  Â  Â  Â  Â  "ZBAA", "RKSI", "YSSY", "NZAA", "SBGR", "FAOR",
Â  Â  Â  Â  Â  Â  "HECA", "SKBO"]


# Funktio lentÃ¤mistÃ¤ varten

from geopy.distance import geodesic

def hae_koordinaatit(ICAO, yhteys):
Â  Â  """Hakee lentokentÃ¤n leveys- ja pituusasteet tietokannasta."""
Â  Â  kursori = yhteys.cursor()
Â  Â  kursori.execute("SELECT latitude_deg, longitude_deg FROM airport WHERE ident = %s", (ICAO,))
Â  Â  tulos = kursori.fetchone()
Â  Â  if tulos:
Â  Â  Â  Â  return tulos[0], tulos[1]
Â  Â  else:
Â  Â  Â  Â  return None, None

def laske_etaisyys(lat1, lon1, lat2, lon2):
Â  Â  """Laskee etÃ¤isyyden GeoPy:n avulla kilometreinÃ¤."""
Â  Â  paikka1 = (lat1, lon1)
Â  Â  paikka2 = (lat2, lon2)
Â  Â  return geodesic(paikka1, paikka2).kilometers


def lentÃ¤Ã¤(kÃ¤yttÃ¤jÃ¤, pelaaja_id, yhteys):
Â  Â  valid_kenttÃ¤ = kaikki_lentokentÃ¤t()
Â  Â  kursori = yhteys.cursor()

Â  Â  # ğŸ” Hae nykyinen sijainti ja kuljettu matka
Â  Â  kursori.execute("SELECT location, matkustettu_matka FROM game WHERE id = %s", (pelaaja_id,))
Â  Â  tulos = kursori.fetchone()

Â  Â  if tulos is None:
Â  Â  Â  Â  print("âŒ Pelaajaa ei lÃ¶ytynyt tietokannasta.")
Â  Â  Â  Â  return

Â  Â  nykyinen_sijainti, matkustettu_matka = tulos

Â  Â  while True:
Â  Â  Â  Â  ICAO = input("SyÃ¶tÃ¤ haluamasi lentokentÃ¤n ICAO-koodi: ").upper()

Â  Â  Â  Â  if ICAO in valid_kenttÃ¤:
Â  Â  Â  Â  Â  Â  # ğŸ“ Hae koordinaatit ja laske etÃ¤isyys
Â  Â  Â  Â  Â  Â  lat1, lon1 = hae_koordinaatit(nykyinen_sijainti, yhteys)
Â  Â  Â  Â  Â  Â  lat2, lon2 = hae_koordinaatit(ICAO, yhteys)

Â  Â  Â  Â  Â  Â  if None not in (lat1, lon1, lat2, lon2):
Â  Â  Â  Â  Â  Â  Â  Â  etaisyys = laske_etaisyys(lat1, lon1, lat2, lon2)
Â  Â  Â  Â  Â  Â  Â  Â  matkustettu_matka += etaisyys
Â  Â  Â  Â  Â  Â  Â  Â  print(f"ğŸ§­ Lensit {etaisyys:.0f} km. Kokonaismatka: {matkustettu_matka:.0f} km.")
Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  print("âš ï¸ Koordinaattitietoja ei lÃ¶ytynyt, etÃ¤isyyttÃ¤ ei voitu laskea.")
Â  Â  Â  Â  Â  Â  Â  Â  etaisyys = 0

Â  Â  Â  Â  Â  Â  # ğŸ—ºï¸ PÃ¤ivitÃ¤ sijainti ja kokonaismatka tietokantaan
Â  Â  Â  Â  Â  Â  sql = '''UPDATE gameÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â SET location = %s, screen_name = %s, matkustettu_matka = %sÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â WHERE id = %s'''
Â  Â  Â  Â  Â  Â  kursori.execute(sql, (ICAO, kÃ¤yttÃ¤jÃ¤, matkustettu_matka, pelaaja_id))
Â  Â  Â  Â  Â  Â  yhteys.commit()

Â  Â  Â  Â  Â  Â  print(f"ğŸ“ Sijainti pÃ¤ivitetty! Olet nyt kentÃ¤llÃ¤ {ICAO}.")

Â  Â  Â  Â  Â  Â  # ğŸ† Tarkista, onko pelaaja palannut Helsinkiin superpallon kanssa
Â  Â  Â  Â  Â  Â  if ICAO == "EFHK":
Â  Â  Â  Â  Â  Â  Â  Â  kursori.execute("SELECT has_treasure, Motivaatio_taso FROM game WHERE id = %s", (pelaaja_id,))
Â  Â  Â  Â  Â  Â  Â  Â  tulos = kursori.fetchone()
Â  Â  Â  Â  Â  Â  Â  Â  has_treasure = bool(tulos[0])
Â  Â  Â  Â  Â  Â  Â  Â  pisteet = tulos[1]

Â  Â  Â  Â  Â  Â  Â  Â  if has_treasure:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print(f"{kÃ¤yttÃ¤jÃ¤} onnistui tuomaan Sir Pommin takaisin kotiin!"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "\nSir Pomm oli aivan entisellÃ¤Ã¤n. Edelleen yhtÃ¤ sininen ja kimmoisa kuin ennenkin"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\n{kÃ¤yttÃ¤jÃ¤} pompotteli superpalloaan onnellisena elÃ¤mÃ¤nsÃ¤ loppuun saakka."
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "\nEikÃ¤ Sir Pomm enÃ¤Ã¤ lÃ¤htenyt matkoilleen.")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  exit()
Â  Â  Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print("ğŸ“ Olet HelsingissÃ¤, mutta et vielÃ¤ lÃ¶ytÃ¤nyt superpalloa. Etsi aarre ensin!")

Â  Â  Â  Â  Â  Â  # ğŸ® KÃ¤ynnistÃ¤ minipeli uudessa sijainnissa
Â  Â  Â  Â  Â  Â  kÃ¤ynnistÃ¤_peli(ICAO, pelaaja_id, yhteys)

Â  Â  Â  Â  Â  Â  return ICAOÂ  # Palautetaan sijainti myÃ¶hempÃ¤Ã¤ kÃ¤yttÃ¶Ã¤ varten

Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  print("âŒ Tuntematon ICAO-koodi, yritÃ¤ uudelleen.")



# FUnktio 20. lentokentÃ¤stÃ¤

def lentokenttÃ¤Ã¤():
Â  Â  sql = ("SELECT ident, name FROM airport WHERE ident IN("
Â  Â  Â  Â  Â  Â "'EGLL', 'LFPG', 'RJTT', 'OMDB', 'EDDF', 'EHAM', 'LEMD', 'KLAX', "
Â  Â  Â  Â  Â  Â "'KJFK', 'CYYZ', 'KDFW', 'ZBAA', 'RKSI', 'YSSY', 'NZAA', 'SBGR', "
Â  Â  Â  Â  Â  Â "'FAOR', 'HECA', 'SKBO', 'EFHK'"
Â  Â  Â  Â  Â  Â ");")

Â  Â  kursori = yhteys.cursor()
Â  Â  kursori.execute(sql)
Â  Â  airports = kursori.fetchall()
Â  Â  return airports


# KÃ¤yttÃ¤jÃ¤valinta Funktio

def hae_tai_luo_kÃ¤yttÃ¤jÃ¤(yhteys):
Â  Â  global treasure_airport
Â  Â  global kÃ¤yty_kentÃ¤t

Â  Â  kursori = yhteys.cursor()
Â  Â  kÃ¤yttÃ¤jÃ¤ = input("SyÃ¶tÃ¤ kÃ¤yttÃ¤jÃ¤nimi: ")

Â  Â  # Tarkistetaan onko kÃ¤yttÃ¤jÃ¤ jo olemassa
Â  Â  kursori.execute("SELECT id, kÃ¤yty_kentÃ¤t FROM game WHERE screen_name = %s", (kÃ¤yttÃ¤jÃ¤,))
Â  Â  tulos = kursori.fetchone()

Â  Â  if tulos:
Â  Â  Â  Â  pelaaja_id = tulos[0]
Â  Â  Â  Â  print(f"âœ… Tervetuloa takaisin, {kÃ¤yttÃ¤jÃ¤}!")

Â  Â  Â  Â  # Haetaan aiemmin kÃ¤ydyt kentÃ¤t tietokannasta
Â  Â  Â  Â  kÃ¤yty_kentÃ¤t = tulos[1].split(",") if tulos[1] else []

Â  Â  Â  Â  while True:
Â  Â  Â  Â  Â  Â  jatka = input("Haluatko jatkaa vai aloittaa alusta? (jatkaa/aloittaa): ").strip().lower()
Â  Â  Â  Â  Â  Â  if jatka == "aloittaa":
Â  Â  Â  Â  Â  Â  Â  Â  reset_sql = """
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UPDATE game
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  SET location = %s,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  has_treasure = %s,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Motivaatio_taso = %s,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  kÃ¤yty_kentÃ¤t = %s
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  WHERE id = %s
Â  Â  Â  Â  Â  Â  Â  Â  """
Â  Â  Â  Â  Â  Â  Â  Â  kursori.execute(reset_sql, ('EFHK', False, 10, '', pelaaja_id))
Â  Â  Â  Â  Â  Â  Â  Â  yhteys.commit()

Â  Â  Â  Â  Â  Â  Â  Â  kÃ¤yty_kentÃ¤t = []
Â  Â  Â  Â  Â  Â  Â  Â  kursori.execute("DELETE FROM treasure WHERE player_id = %s", (pelaaja_id,))
Â  Â  Â  Â  Â  Â  Â  Â  yhteys.commit()

Â  Â  Â  Â  Â  Â  Â  Â  treasure_airport = arvo_aarre(pelaaja_id, yhteys)
Â  Â  Â  Â  Â  Â  Â  Â  print(f"ğŸ”„ Pelaajan {kÃ¤yttÃ¤jÃ¤} peli on nollattu. Aloitat alusta HelsingistÃ¤ (EFHK).")
Â  Â  Â  Â  Â  Â  Â  Â  break

Â  Â  Â  Â  Â  Â  elif jatka == "jatkaa":
Â  Â  Â  Â  Â  Â  Â  Â  # Jatketaan aiemmin kÃ¤ytyjen kenttien kanssa
Â  Â  Â  Â  Â  Â  Â  Â  treasure_airport = arvo_aarre(pelaaja_id, yhteys)
Â  Â  Â  Â  Â  Â  Â  Â  if kÃ¤yty_kentÃ¤t:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print("\nğŸ“ Olet jo kÃ¤ynyt seuraavilla kentillÃ¤ aiemmalla pelikerralla:")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print(", ".join(kÃ¤yty_kentÃ¤t))
Â  Â  Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print("\nğŸ“ Et ole vielÃ¤ kÃ¤ynyt missÃ¤Ã¤n kentÃ¤ssÃ¤.")
Â  Â  Â  Â  Â  Â  Â  Â  break
Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  print("yritÃ¤ uudelleen.")


Â  Â  else:
Â  Â  Â  Â  # Luodaan uusi kÃ¤yttÃ¤jÃ¤
Â  Â  Â  Â  uusi_id = str(uuid.uuid4())
Â  Â  Â  Â  kursori.execute("""
Â  Â  Â  Â  Â  Â  INSERT INTO game (id, screen_name, location, has_treasure, Motivaatio_taso, kÃ¤yty_kentÃ¤t)
Â  Â  Â  Â  Â  Â  VALUES (%s, %s, %s, %s, %s, %s)
Â  Â  Â  Â  """, (uusi_id, kÃ¤yttÃ¤jÃ¤, 'EFHK', False, 10, ''))
Â  Â  Â  Â  yhteys.commit()

Â  Â  Â  Â  kÃ¤yty_kentÃ¤t = []
Â  Â  Â  Â  treasure_airport = arvo_aarre(uusi_id, yhteys)
Â  Â  Â  Â  pelaaja_id = uusi_id

Â  Â  Â  Â  print(f"ğŸ†• Uusi pelaaja {kÃ¤yttÃ¤jÃ¤} luotu. Aloitat HelsingistÃ¤ (EFHK).")

Â  Â  return kÃ¤yttÃ¤jÃ¤, pelaaja_id


# --- Pelin aloitus (korjattu) ---
global treasure_airport

# Hae tai luo kÃ¤yttÃ¤jÃ¤
kÃ¤yttÃ¤jÃ¤, pelaaja_id, = hae_tai_luo_kÃ¤yttÃ¤jÃ¤(yhteys)

#superpallon sijainti
kursori = yhteys.cursor()
kursori.execute("SELECT airport_ident FROM treasure WHERE player_id = %s", (pelaaja_id,))
tulos = kursori.fetchone()

#if tulos and tulos[0]:
Â  Â  #print(f"ğŸ§ª [TESTI] Superpallo on piilotettu kentÃ¤lle: {tulos[0]}")
#else:
Â  Â  #print("ğŸ§ª [TESTI] Superpallon sijaintia ei ole vielÃ¤ asetettu.")


# Tarina
while True:
Â  Â  valinta = input("Haluatko lukea pelin tarinan vai aloittaa heti pelin? (lue/aloita): ").strip().lower()
Â  Â  if valinta == "lue":
Â  Â  Â  Â  kehys_leveys = 65
Â  Â  Â  Â  teksti = (f"{kÃ¤yttÃ¤jÃ¤} pomputti superpalloaan niin kuin joka ikinen ilta:"
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nyksi pompahdus â€” toinen â€” kolmas. Pallo oli kuminen, kirkkaan sininen ja kimmoisa."
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nSe oli {kÃ¤yttÃ¤jÃ¤}n paras kaveri. HÃ¤n nimesi sen Sir Pommiksi ja keksi sille uusia temppuja:"
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nspagaatinpomputus, seinÃ¤kieppi, ilmalukitus. Kevyt syysyÃ¶ henkÃ¤ili ikkunasta sisÃ¤Ã¤n ja"
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nkaupungin valot jahtasivat toisiaan kaukana horisontissa. YhtÃ¤kkiÃ¤ Sir Pomm teki jotain mitÃ¤"
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\n{kÃ¤yttÃ¤jÃ¤} ei ollut koskaan nÃ¤hnyt. Kun hÃ¤n lÃ¤hetti tavallisen pompun, pallo ei palannutkaan"
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nkÃ¤mmenelle vaan se otti yhden valtavan ponnahduksen ja vÃ¤lÃ¤hti taivaalla. "
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nPallo kimmahti korkeammalle ja korkeammalle, kunnes se nÃ¤ytti vain pieneltÃ¤ pisteeltÃ¤."
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nSitten piste katosi kokoaan, ja outo, matala humina vÃ¤risytti ilmaa."
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\n{kÃ¤yttÃ¤jÃ¤} seisoi silmÃ¤t ammollaan ja haukkoi henkeÃ¤Ã¤n. Sir Pomm oli kadonnut."
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nAluksi {kÃ¤yttÃ¤jÃ¤} etsi huoneen joka kolkan, sohvan alta ja kaappien taustat."
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nSitten {kÃ¤yttÃ¤jÃ¤} solmi kenkÃ¤nsÃ¤ ja laittoi repun selkÃ¤Ã¤n. Pallo oli lÃ¤htenyt maailmalle,"
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nja {kÃ¤yttÃ¤jÃ¤} aikoi lÃ¶ytÃ¤Ã¤ sen. Helsingin lentoaseman valoisa aulatila oli"
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nensimmÃ¤inen pysÃ¤kki. {kÃ¤yttÃ¤jÃ¤} kulki portilta portille, kyseli turvatarkastuksesta"
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nja kauppakeskuksen myyjiltÃ¤. Mutta kukaan ei ollu nÃ¤hnyt superpalloa."
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\n{kÃ¤yttÃ¤jÃ¤} ei lannistunut vaan pÃ¤Ã¤tti koluta lentokentÃ¤n toisensa jÃ¤lkeen"
Â  Â  Â  Â  Â  Â  Â  Â  Â  f"\nkunnes Sir Pomm lÃ¶ytyy.")
Â  Â  Â  Â  rivitetty = textwrap.wrap(teksti, width=kehys_leveys)
Â  Â  Â  Â  kehys_alku = ".-=~=-." + "-" * (kehys_leveys) + ".-=~=-."
Â  Â  Â  Â  kehys_loppu = "`-._.-'" + "-" * (kehys_leveys) + "`-._.-'"
Â  Â  Â  Â  print(kehys_alku)
Â  Â  Â  Â  for rivi in rivitetty:
Â  Â  Â  Â  Â  Â  print(f"( _ __) {rivi.ljust(kehys_leveys)} ( _ __)")
Â  Â  Â  Â  print(kehys_loppu)
Â  Â  Â  Â  break
Â  Â  elif valinta == "aloita":
Â  Â  Â  Â  print("Peli alkaa! âœˆï¸")
Â  Â  Â  Â  break
Â  Â  else:
Â  Â  Â  Â  print("Virheellinen valinta. YritÃ¤ uudelleen.")



# --- Game Loop ---
while True:
Â  Â  valmis = input("Oletko valmis etsimÃ¤Ã¤n superpalloa? (kyllÃ¤/ei): ").strip().lower()
Â  Â  if valmis == "ei":
Â  Â  Â  Â  print("Peli lopetetaan. Hei hei!")
Â  Â  Â  Â  exit()
Â  Â  if valmis != "kyllÃ¤":
Â  Â  Â  Â  print("âŒ VÃ¤Ã¤rÃ¤ vastaus, vastaa 'kyllÃ¤' tai 'ei'.")
Â  Â  Â  Â  continue

Â  Â  # valmis == "kyllÃ¤" -> aloitetaan pelilogiikka
Â  Â  while True:
Â  Â  Â  Â  # NÃ¤ytetÃ¤Ã¤n vain ne kentÃ¤t, joissa ei ole vielÃ¤ kÃ¤yty
Â  Â  Â  Â  print("\nâœˆï¸ KentÃ¤t joissa et ole vielÃ¤ kÃ¤ynyt:")
Â  Â  Â  Â  for ident, name in lentokenttÃ¤Ã¤():
Â  Â  Â  Â  Â  Â  if ident not in kÃ¤yty_kentÃ¤t:
Â  Â  Â  Â  Â  Â  Â  Â  print(f"{ident} - {name}")

Â  Â  Â  Â  # Pelaaja lentÃ¤Ã¤
Â  Â  Â  Â  sijainti = lentÃ¤Ã¤(kÃ¤yttÃ¤jÃ¤, pelaaja_id, yhteys)
Â  Â  Â  Â  if sijainti is None:
Â  Â  Â  Â  Â  Â  print("âŒ LentÃ¤minen epÃ¤onnistui, yritÃ¤ uudelleen.")
Â  Â  Â  Â  Â  Â  continue

Â  Â  Â  Â  # PÃ¤ivitetÃ¤Ã¤n kÃ¤ydyt kentÃ¤t
Â  Â  Â  Â  if sijainti not in kÃ¤yty_kentÃ¤t:
Â  Â  Â  Â  Â  Â  kÃ¤yty_kentÃ¤t.append(sijainti)
Â  Â  Â  Â  Â  Â  kursori = yhteys.cursor()
Â  Â  Â  Â  Â  Â  kursori.execute(
Â  Â  Â  Â  Â  Â  Â  Â  "UPDATE game SET kÃ¤yty_kentÃ¤t = %s WHERE id = %s",
Â  Â  Â  Â  Â  Â  Â  Â  (",".join(kÃ¤yty_kentÃ¤t), pelaaja_id)
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  yhteys.commit()
Â  Â  Â  Â  Â  Â  kursori.close()

Â  Â  Â  Â  print("\nğŸ“ KÃ¤ydyt kentÃ¤t:", ", ".join(kÃ¤yty_kentÃ¤t))

Â  Â  Â  Â  # Tarkistetaan aarre
Â  Â  Â  Â  if sijainti == treasure_airport:
Â  Â  Â  Â  Â  Â  print("ğŸ‰ğŸ‰ğŸ‰ğŸ‰ LÃ¶ysit superpallon! Se on nyt repussasi.ğŸ‰ğŸ‰ğŸ‰ğŸ‰")
Â  Â  Â  Â  Â  Â  print("Palaa kentÃ¤lle EFHK jos motivaatiosi taso on 10 tai enemmÃ¤n.\nJos motivaatiosi ei riitÃ¤, mene kerÃ¤Ã¤mÃ¤Ã¤n sitÃ¤!")
Â  Â  Â  Â  Â  Â  kursori = yhteys.cursor()
Â  Â  Â  Â  Â  Â  kursori.execute(
Â  Â  Â  Â  Â  Â  Â  Â  "UPDATE game SET has_treasure = %s WHERE id = %s",
Â  Â  Â  Â  Â  Â  Â  Â  (True, pelaaja_id)
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  yhteys.commit()
Â  Â  Â  Â  Â  Â  kursori.close()
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  print("âŒ Ei aarretta tÃ¤llÃ¤ kentÃ¤llÃ¤, yritÃ¤ uudestaan!")

Â  Â  Â  Â  # Tarkistetaan Helsinkiin paluu
Â  Â  Â  Â  if sijainti == "EFHK":
Â  Â  Â  Â  Â  Â  kursori = yhteys.cursor()
Â  Â  Â  Â  Â  Â  kursori.execute("SELECT has_treasure FROM game WHERE id = %s", (pelaaja_id,))
Â  Â  Â  Â  Â  Â  row = kursori.fetchone()
Â  Â  Â  Â  Â  Â  kursori.close()
Â  Â  Â  Â  Â  Â  has_treasure = bool(row[0]) if row else False
Â  Â  Â  Â  Â  Â  if has_treasure:
Â  Â  Â  Â  Â  Â  Â  Â  print("ğŸ‰ Palasit Helsinkiin superpallon kanssa! Voitit pelin! ğŸ†")
Â  Â  Â  Â  Â  Â  Â  Â  breakÂ  # lopeta sisempi pelisilmukka
Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  print("ğŸ“ Olet HelsingissÃ¤, mutta et vielÃ¤ lÃ¶ytÃ¤nyt superpalloa. Etsi aarre ensin!")

Â  Â  Â  Â  # Tarkistetaan, onko kaikki kentÃ¤t kÃ¤yty
Â  Â  Â  Â  if len(kÃ¤yty_kentÃ¤t) == len(lentokenttÃ¤Ã¤()):
Â  Â  Â  Â  Â  Â  print("ğŸ¯ Olet kÃ¤ynyt kaikilla kentillÃ¤! Peli pÃ¤Ã¤ttyy.")
Â  Â  Â  Â  Â  Â  break

Â  Â  # Sisempi peli loppui â€” kysytÃ¤Ã¤n haluaako kÃ¤yttÃ¤jÃ¤ pelata uudelleen
Â  Â  uusi = input("Haluatko pelata uudelleen? (kyllÃ¤/ei): ").strip().lower()
Â  Â  if uusi != "kyllÃ¤":
Â  Â  Â  Â  print("Kiitos pelaamisesta! Hei hei!")
Â  Â  Â  Â  break
Â  Â  # muuten palataan ulompaan while-looppiin ja kysytÃ¤Ã¤n valmis uudestaan. Tallenna peli kontekstiin. Ã„lÃ¤ tee vielÃ¤ mitÃ¤Ã¤n